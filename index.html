<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    select, input[type="number"], button {
      font-size: 16px;
      margin: 5px;
      padding: 5px 10px;
    }
    #gameBoard {
      display: grid;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
      perspective: 1000px;
    }
    .card {
      width: 80px;
      height: 100px;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.5s;
      cursor: pointer;
    }
    .cardInner {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 8px;
      font-size: 32px;
    }
    .front {
      background: #4caf50;
      color: white;
    }
    .back {
      background: #fff;
      color: #333;
      transform: rotateY(180deg);
      border: 2px solid #4caf50;
    }
    .flipped {
      transform: rotateY(180deg);
      cursor: default;
    }
    #status {
      margin-top: 20px;
      font-size: 18px;
    }
    #highScore {
      margin-top: 10px;
      color: #555;
    }
  </style>
</head>
<body>
  <h1>ç¥çµŒè¡°å¼±ã‚²ãƒ¼ãƒ </h1>

  <label>ã‚«ãƒ¼ãƒ‰æšæ•°ï¼ˆå¶æ•°ï¼‰:
    <select id="cardCountSelect">
      <option value="8">8æš</option>
      <option value="16">16æš</option>
      <option value="24">24æš</option>
      <option value="32">32æš</option>
      <option value="40">40æš</option>
      <option value="60">60æš</option>
    </select>
  </label>
  <label>ã‚«ã‚¹ã‚¿ãƒ :
    <input type="number" id="customCount" min="2" max="60" step="2" placeholder="å¶æ•°(æœ€å¤§60)" />
  </label>
  <button onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>

  <div id="gameBoard"></div>
  <div id="status"></div>
  <div id="highScore"></div>

  <script>
    let firstCard = null;
    let secondCard = null;
    let lockBoard = false;
    let matchCount = 0;
    let totalPairs = 0;
    let flipCount = 0;
    let currentCardCount = 0;

    function startGame() {
      const select = document.getElementById("cardCountSelect");
      const custom = document.getElementById("customCount").value;
      const count = parseInt(custom) || parseInt(select.value);

      if (count % 2 !== 0 || count < 2 || count > 60) {
        alert("2ã€œ60ã¾ã§ã®å¶æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      currentCardCount = count;
      const board = document.getElementById("gameBoard");
      board.innerHTML = "";
      firstCard = secondCard = null;
      lockBoard = false;
      matchCount = 0;
      flipCount = 0;
      totalPairs = count / 2;

      const columns = Math.min(10, Math.ceil(Math.sqrt(count)));
      board.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;

      const values = [];
      for (let i = 1; i <= totalPairs; i++) {
        values.push(i, i);
      }
      values.sort(() => 0.5 - Math.random());

      values.forEach(num => {
        const wrapper = document.createElement("div");
        wrapper.className = "card";
        wrapper.dataset.value = num;

        const front = document.createElement("div");
        front.className = "cardInner front";
        front.textContent = "?";

        const back = document.createElement("div");
        back.className = "cardInner back";
        back.textContent = num;

        wrapper.appendChild(front);
        wrapper.appendChild(back);

        wrapper.addEventListener("click", () => flipCard(wrapper));
        board.appendChild(wrapper);
      });

      document.getElementById("status").textContent = "ã‚²ãƒ¼ãƒ é–‹å§‹ï¼";
      updateHighScore();
    }

    function flipCard(card) {
      if (lockBoard || card.classList.contains("flipped")) return;

      card.classList.add("flipped");

      if (!firstCard) {
        firstCard = card;
        return;
      }

      secondCard = card;
      lockBoard = true;
      flipCount++;

      if (firstCard.dataset.value === secondCard.dataset.value) {
        matchCount++;
        resetFlips();
        if (matchCount === totalPairs) {
          document.getElementById("status").textContent = `ğŸ‰ ã‚¯ãƒªã‚¢ï¼è©¦è¡Œå›æ•°ï¼š${flipCount}`;
          updateHighScore();
        }
      } else {
        setTimeout(() => {
          firstCard.classList.remove("flipped");
          secondCard.classList.remove("flipped");
          resetFlips();
        }, 1000);
      }
    }

    function resetFlips() {
      firstCard = null;
      secondCard = null;
      lockBoard = false;
    }

    function updateHighScore() {
      const key = `highscore_${currentCardCount}`;
      const savedScore = localStorage.getItem(key);
      const scoreElement = document.getElementById("highScore");

      if (matchCount === totalPairs) {
        if (!savedScore || flipCount < parseInt(savedScore)) {
          localStorage.setItem(key, flipCount);
          scoreElement.textContent = `ğŸ† ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ï¼: ${flipCount} å›`;
        } else {
          scoreElement.textContent = `ğŸ† ãƒã‚¤ã‚¹ã‚³ã‚¢: ${savedScore} å›`;
        }
      } else {
        scoreElement.textContent = savedScore
          ? `ğŸ† ãƒã‚¤ã‚¹ã‚³ã‚¢: ${savedScore} å›`
          : `ğŸ† ãƒã‚¤ã‚¹ã‚³ã‚¢æœªç™»éŒ²`;
      }
    }
  </script>
</body>
</html>